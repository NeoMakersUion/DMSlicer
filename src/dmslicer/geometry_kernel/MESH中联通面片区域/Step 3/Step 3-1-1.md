你这一串问题**非常成熟**，而且不是“钻牛角尖”——它们正好是把 Step C / Step D 从“口号”变成“可实施研究方法”的关键。你担心“死循环”也很对：如果 ε 没有定义来源，算法就会变成拍脑袋调参。

我们按你要求：**只完成第一步（B：软门控 + ε 的规范化定义）**，不往后跳实现细节。下面我把你问的三件事逐个“定规矩”，让它变成可写进论文的方法。

---

# 第一部分：ε（gap tolerance）到底怎么定义才不死循环？

你问的核心是：

- 我把坐标放大成整数了，ε 怎么算？
    
- ε 初值、每次放宽步长怎么定？有没有数据依据？
    
- ε 和 gap / patch 规则会不会互相依赖，形成死循环？
    

## ✅ 关键原则（避免死循环）

> **ε 必须来自“数据尺度（mesh scale）”与“离散误差上界”的先验估计**，  
> 而不是来自算法输出。

换句话说：  
ε 不能“看结果再调”，而应该“先定合理范围，再用数据驱动微调”。

---

## 1) 你用“整数坐标”的做法完全没问题，ε 也要同一单位

你现在是：

- 把坐标乘一个 `S = 10^DECIMALS`（或 100、1000）
    
- 转成 int
    
- 用整数运算
    

那么 ε 的单位也必须是“整数单位”。

### ✅ 正确写法（定义式）

- 设真实世界单位为 mm
    
- 设缩放因子为 `S`（例如 1000 表示 0.001mm 精度）
    
- 你想允许的几何间隙容差是 `ε_mm`
    

那么：  
[  
\varepsilon_{\text{int}} = \lceil \varepsilon_{\text{mm}} \cdot S \rceil  
]

> 这就解决了 “ε 不是 float 怎么办” 的问题：  
> 你只是在换单位。

---

## 2) ε 初值应该从哪里来？（这才是“科学依据”）

你提到边长、三角形大小、网格粗细——你直觉完全对。更专业的做法是用**“局部网格分辨率”**来定义 ε 的尺度。

### ✅ 推荐一个最常用、最稳的尺度量：局部特征长度 (h)

对一个三角形 (t)，定义：

- `h(t)` = 三条边长度的中位数（median edge length）或平均值
    

对于 tri-pair (tA, tB)，定义：  
[  
h_{AB} = \min(h(t_A), h(t_B))  
]  
（用更细的一侧做尺度，防止粗网格误导）

然后设：  
[  
\varepsilon_0 = \alpha \cdot h_{AB}  
]  
其中 (\alpha) 是一个小系数（比如 0.01、0.02 级别）。

这背后的科学依据是：

> 离散几何能“分辨”的最小特征尺度，通常与边长同阶；  
> 你允许的 gap 容差不应超过局部采样分辨率。

### ✅ 你担心的“壳–核不同三角大小”正好靠这条解决

- 外壳细 → h 小 → ε 小
    
- 内核粗 → h 大，但我们取 min → 仍以细侧为准  
    避免“粗网格一口气吞掉误差”。
    

---

## 3) ε 放宽是手算还是自适应？——可以“有规矩地自适应”

你说得对：不能拍脑袋一步一步放大。

### ✅ 一个不死循环的做法：使用“离散层级 schedule”

设放宽倍数为 (\gamma > 1)：  
[  
\varepsilon_k = \varepsilon_0 \cdot \gamma^k  
]  
例如 (\gamma = 1.5) 或 2。

然后给一个明确上界（防止无限放大）：  
[  
\varepsilon_k \le \varepsilon_{\max} = \beta \cdot h_{AB}  
]  
其中 (\beta) 比如 0.1（不超过局部边长的 10%）。

✅ 这样你就有：

- 初值：来自网格分辨率（客观）
    
- 放宽：指数/等比 schedule（可复现）
    
- 上界：防止吸附错误（可解释）
    

这完全不是死循环，因为所有参数都来自“几何尺度”，不是来自输出 patch。

---

# 第二部分：你担心 Step D 的“平滑性”，立方体怎么办？

你指出的点非常关键：  
**立方体有锐边，法线场不平滑**。

所以“平滑性”不能写成“全局连续”。正确做法是：

## ✅ 把“平滑性”改成“局部一致性 + 多模态（多平面）允许”

更专业的表述：

> patch 内允许存在**少数离群**，并且允许在锐边处形成多个子 patch（多平面），但每个子 patch 内法线统计一致。

换句话说：

- 立方体的一个面：法线一致 ✅
    
- 立方体跨越拐角：应该分成两个 patch，而不是强行一片
    

这也回到你最初的定义：你要的是“公共区域”，通常在锐边处确实应该断开。

### 你问的“局部到底多局部？”

这里别写得太玄，给一个可实现的定义即可：

- 邻接关系：共享边的三角形（1-ring）
    
- 局部平滑：比较 1-ring 内法线差的统计（均值/中位数）
    

锐边就会显著超阈值，自然断开。

---

# 第三部分：你担心“延伸出来的一片也能局部平滑，那不就废了？”

这个担心非常对：**平面误吸区域**确实可能也“很平滑”，所以光靠法线平滑不够。

但注意：这不是 Step D 的问题，这是你必须把 Step D 写成“多指标联合”的原因。

✅ 你需要的是：

- 法线一致性（必要条件）
    
- **gap 分布集中**（必要条件）
    
- **面积支持度与紧致度**（对抗平面延伸的关键）
    

尤其是紧致度/边界形状能杀掉“无限延伸的薄片误吸”。

不过——按你说的“第一步没完成不进第二步”，这里我就只把它写成一句规范，不展开算法：

> **Normal coherence is necessary but not sufficient; patch validation must incorporate gap coherence and region support/compactness to prevent planar over-extension artifacts.**

---

# ✅ 第一阶段（你要求的“第一步”）我们现在可以定稿成三条规范

你看看这三条能不能作为你方法里的“硬规定”：

1. **Soft normal gating**：三角形对的法线夹角用于打分；仅在极端角度时剔除，patch 用统计一致性约束。
    
2. **Scale-aware ε**：ε 以局部网格特征长度 (h) 定义，(\varepsilon_0=\alpha h)，并有 (\varepsilon_{\max}=\beta h) 上界。
    
3. **Integer scaling compatibility**：若坐标放大为整数，ε 同单位缩放，(\varepsilon_{\text{int}}=\lceil \varepsilon_{\text{mm}} S\rceil)。
    

---

## 现在只问你一个确认问题（锁定第一步）

为了让第一步“可复现”，你愿不愿意接受这种写法：

> **用局部边长尺度 h 来自动确定 ε0 与 εmax**，  
> 而不是人工指定一个全局 ε？

你回答 **接受 / 不接受**。  
接受的话，第一步就完全闭环了；然后我们再进入第二步（多指标联合验证，解决你担心的平面延伸）。