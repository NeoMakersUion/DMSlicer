# 第一阶段（Step 1）｜正式方法规范（定稿版）

> **目标**：  
> 在独立离散的三角网格之间，构建稳定、可复现的候选公共区域生成基础，  
> 避免因法线误判、$\varepsilon$ 设定随意或离散误差导致的系统性错误。

---

## 1️⃣ Soft Normal Gating（软法线门控）

- 对每个候选三角形对 $(t_A, t_B)$，计算法线夹角 $\theta$
    
- 法线一致性作为**可信度因子**而非硬约束
    
- 仅在极端不可能形成面–面区域的情况下（如 $\theta > 60^\circ$）直接剔除
    
- patch 层面通过统计一致性约束法线方向
    

**解决的问题**：

- 防止明显垂直/立面误配
    
- 保留因离散误差导致的局部法线偏差
    

**不解决的问题**：

- 不保证单个 tri 对一定正确
    
- 不做最终区域判断
    

---

## 2️⃣ Scale-Aware Gap Tolerance（尺度感知 $\varepsilon$）

- 定义局部特征长度 $h(t)$ 为三角形边长中位数
    
- tri 对的尺度取：  
    $$ h_{AB} = \min(h(t_A), h(t_B)) $$
    
- 初始 gap 容差：  
    $$ \varepsilon_0 = \alpha \cdot h_{AB} $$
    
- 最大 gap 上界：  
    $$ \varepsilon_{\max} = \beta \cdot h_{AB}, \quad \beta \ll 1 $$
    

其中 $\alpha,\beta$ 为与数据无关的常数（例如 $\alpha=0.01,\ \beta=0.1$）

**解决的问题**：

- 适配不同网格分辨率
    
- 防止粗网格吞噬误差
    
- 消除 $\varepsilon$ 的人为主观性
    

---

## 3️⃣ Progressive Gap Relaxation（逐级放宽，不死循环）

- 使用固定放宽因子 $\gamma > 1$：  
    $$ \varepsilon_k = \varepsilon_0 \cdot \gamma^k $$
    
- 且始终满足：  
    $$ \varepsilon_k \le \varepsilon_{\max} $$
    
- 放宽过程只用于**候选 patch 的连通扩展**
    
- 不允许独立跳跃吸附新区域
    

**解决的问题**：

- 曲面壳–核的 tri-level 配对失败
    
- 独立网格导致的局部错位
    

---

## 4️⃣ Integer Scaling Compatibility（整数几何一致性）

- 若坐标统一放大因子 $S$ 转为整数表示：  
    $$ \varepsilon_{\text{int}} = \lceil \varepsilon_{\text{mm}} \cdot S \rceil $$
    
- 所有 gap / 距离判断在同一整数尺度下完成
    

**解决的问题**：

- 数值稳定性
    
- 避免 float 精度依赖
    

---

# 第一阶段“完成标准”（这一步你已经达成）

当以下三点成立时，**第一步完成**：

- $\varepsilon$ 的定义完全来源于几何尺度（非拍脑袋）
    
- 法线约束为软约束，允许局部离散误差
    
- 放宽过程有明确上界，避免死循环
    

👉 你已经全部满足。

---

# 非常重要的一句“边界声明”（你以后要反复用）

> **第一阶段仅建立候选区域的几何一致性基础，  
> 并不保证输出即为最终公共区域。**

这句话能帮你挡掉 90% 的“你这一步为什么不完美”的质疑。

---

## 接下来我们才能进入第二步（你说的必须等第一步完成）

### Step 2（下一阶段）的目标将是：

> **多指标联合的 patch-level 验证与误吸抑制**  
> （解决你反复提到的：平面延伸、误吸立面、假连通）

但在进入之前，我只再问你一个**确认性问题**，不是推进：

> **你是否希望在第二步里，  
> 明确引入“patch 支持度（overlap support）”这个核心概念，  
> 把 area 真正作为第一等公民？**

你只回答：**是 / 否**。  
答完我们再继续。