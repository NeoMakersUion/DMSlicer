  # 你先记住一个总画面（先有图再看公式）

- BVH 给你一堆候选对：$(t^A, t^B)$。
    
- 我们把它们当成一张**二部图**（bipartite graph）：
    
    - 左边节点：A 的三角形
        
    - 右边节点：B 的三角形
        
    - 一条边：表示“这对三角形很近/可能接触”（来自 BVH）
        

然后 2.1–2.3 做的是：

> **在一个接触连通分量 $C_k$ 里面，把边按“几何一致性”剪掉，剪完以后剩下的每个连通块就是一个 PatchPair。**

---

# 2.1 公式到底在说什么？

## 2.1 我写的是什么

对固定的 $C_k$，考虑子图：  
$
G_k=(C_k^A\cup C_k^B,\ E_k)
$

## 每个符号是什么意思

- $C_k$：**接触图 $G$** 的第 $k$ 个连通分量（你说的“锁链结构”就是连通分量里可能发生的形态）
    
- $C_k^A$：这个连通分量里，属于 A 的那些三角形集合  
    （也就是：所有在 $C_k$ 中出现过的 A 三角形）
    
- $C_k^B$：同理，属于 B 的那些三角形集合
    
- $C_k^A \cup C_k^B$：把 A-side 和 B-side 的节点都收集起来（这就是图的节点集合）
    
- $E_k$：连通分量内部的边集合，也就是：  
    $$
    E_k=\{(t_i^A,t_j^B)\in \mathcal{C}\mid t_i^A\in C_k^A,\ t_j^B\in C_k^B\}
    $$  
    白话：**只保留属于这个分量的 tri-pair 边**
    
- $G_k$：就是“把第 $k$ 个连通分量单独拿出来”的那张小图
    

## 白话等价

> 2.1 的意思是：  
> **不要在全局图上乱剪边**，  
> 而是把每个连通分量 $C_k$ 单独拿出来，变成一个小图 $G_k$，  
> 后面所有操作都只在 $G_k$ 内做。

## 为什么要这样

因为你说的“锁链串起来”的结构，**只会在分量内部存在**；不同分量之间本来就没边，根本不用讨论。

---

# 2.2 公式到底在说什么？

## 2.2 我写的是什么

定义边门控函数：  
$$
\mathrm{KeepEdge}(t_i^A,t_j^B)=
\big(\alpha_{ij}\ge \theta_n\big)\ \land\ \big(g_{ij}\le \theta_g\big)
$$  
只保留通过门控的边：  
$$
E_k'=\{(t_i^A,t_j^B)\in E_k\mid \mathrm{KeepEdge}=1\}
$$  
得到剪枝后的图：  
$$
G_k'=(C_k^A\cup C_k^B,\ E_k')
$$

## 每个符号是什么意思

- $(t_i^A,t_j^B)$：一条边，来自 BVH 的一个 tri-pair
    
- $\alpha_{ij}=|n(t_i^A)\cdot n(t_j^B)|$：
    
    - 两个三角形法线的**无向一致性**（0～1）
        
    - 越接近 1 表示越平行（方向可能相反但无向）
        
- $\theta_n$：法线阈值（比如 0.98，对应约 11° 以内）
    
- $g_{ij}$：这个 tri-pair 的 gap 度量（比如三角形之间的最小距离、或点到三角形距离统计）
    
- $\theta_g$：gap 上限阈值（比如小于某个容差）
    
- $\land$：AND（同时满足）
    
- $E_k$：分量内原始边集合（很多）
    
- $E_k'$：剪枝后的边集合（更干净）
    
- $G_k'$：剪枝后的图
    

## 白话等价

> 2.2 的意思是：  
> 在这个分量里，每条 tri-pair 边都问一句：  
> **“你俩真的像接触吗？”**
> 
> - 法线差太多 → 不是同一块面 → 删边
>     
> - gap 太大 → 不是贴着 → 删边
>     
> 
> 最终只留下“像接触”的边，得到一张被剪干净的小图 $G_k'$。

## 这一步和你锁链反例的关系（非常关键）

你说的锁链结构之所以麻烦，是因为：

- A1 通过 B2 “串”到 A2
    
- 但这条“串起来的边”在几何上很可能：
    
    - 法线不一致
        
    - gap 不一致
        

2.2 做的就是：

> **把这种几何上不一致、只是拓扑上串联的边剪掉**，  
> 剪掉后锁链就断了。

---

# 2.3 公式到底在说什么？

## 2.3 我写的是什么

$
\{P_{k,1},P_{k,2},\dots\}=\mathrm{CC}(G_k')
$

## 每个符号是什么意思

- $\mathrm{CC}(\cdot)$：Connected Components，求连通分量
    
- $G_k'$：剪枝后的图（节点还是 A/B 三角形，边是“几何一致”的 tri-pair）
    
- $P_{k,1},P_{k,2},\dots$：剪完边以后，图自然裂开的若干块
    

## 白话等价

> 2.3 的意思是：  
> 边剪完以后，原来那一大坨 $C_k$ 往往会裂成几坨。  
> 每一坨里面的 tri-pair 都满足“法线一致 + gap 一致”，  
> 因此每一坨就是一个**PatchPair**（一块局部一致的接触面候选）。

---

# 把 2.1–2.3 用一句“程序直觉”串起来（你一看就懂）

1. **把全局图按连通分量拆开**（2.1）
    
2. **在每个分量里删掉不合理的边**（2.2）
    
3. **删完边以后，剩下的每个连通块就是一个 patchpair**（2.3）
    

---

# 最后做一个小检查（确保你真的理解到位）

你现在看懂 2.2 里这句了吗：

$
E_k'=\{e\in E_k \mid \mathrm{KeepEdge}(e)=1\}
$

它的意思是：

- **只是在“删边”**
    
- **没有删节点**
    
- 所以图会“自然裂开”