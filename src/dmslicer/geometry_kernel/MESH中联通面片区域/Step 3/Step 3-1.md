# Step 3-1｜Patch-level 连续性指标：我们要“判定什么是同一块公共区域”

你要的 patch（公共区域）必须能抵抗：

* 独立网格（分辨率不同）
* 离散误差（gap 不为 0）
* 曲面（法线变化）
* 平面（边界延伸风险）

所以指标必须覆盖 **3 大维度**：
**距离一致性**、**方向一致性**、**区域连通性/面积支持**。

下面是我建议的“最小指标集合”（不多，但够用）。

---

## ① 距离一致性：Gap Coherence

对任何候选“面片对关系”或 patch 内的采样点，定义 gap（间隙）：

* (g)：Object A 到 Object B 的局部最近距离（可以是点到三角形的距离）

Patch 级别我们关心三件事：

1. **平均间隙**
$$
   \bar g < \varepsilon_g
$$

2. **间隙方差（稳定性）**
$$
   \mathrm{Var}(g) < \sigma_g^2
$$

> 解释：如果只是偶然接近，gap 会忽大忽小；真正公共区域的 gap 在局部应当相对连续。

3. **最大间隙限制（防止“拉长延伸”）**
$$
   \max(g) < \varepsilon_{max}
$$

---

## ② 方向一致性：Normal/Orientation Coherence

这里要避免你刚才提到的“曲面导致配不上”的问题：
**我们不要求法线完全一致，只要求“局部一致 + 平滑变化”。**

Patch 内对每个面片（或采样点）有法线 (n)。

最小两个指标：

1. **法线与局部主方向的夹角**（允许曲面变化）
$$
   \angle(n_i, n_{ref}) < \varepsilon_\theta
$$
   其中$n_{ref}$可以是 patch 的平均法线或 PCA 主方向。

2. **法线场平滑性（相邻面片法线差）**
$$
   \max_{(i,j)\in \mathcal{N}} \angle(n_i, n_j) < \varepsilon_{\theta,local}
$$

> 解释：这条用来把“随机噪声误配”踢出去。

---

## ③ 区域支持：Connectivity + Area Support

你强调“要面积，不要点/边”，所以必须有：

1. **连通性**：patch 在 A（或 B）网格上是连通的一片
  （共享边邻接，不是散点）

2. **面积阈值**：
$$
   \mathrm{Area}(P) > \varepsilon_A
$$

> 用于过滤边–边、点–边造成的零面积伪区域。

3. **紧致性（可选，但对平面延伸非常有效）**
   例如：周长² / 面积（越大越细长，越像错误延伸）
$$
   \frac{\mathrm{Perimeter}(P)^2}{\mathrm{Area}(P)} < \kappa
$$

---

# ✅ 这一步的产物：一个“可写进论文”的 Patch Validity 定义

你可以把有效 patch 定义成：

> 一个 patch 是有效的，当且仅当它同时满足：
> (i) gap 一致性（均值+方差+最大值）；
> (ii) 法线一致性（全局+局部平滑）；
> (iii) 连通且面积足够，并可选满足紧致性约束。

---

# 现在我只问你一个问题（只问一个，确保第一步扎实）

在这三个维度里，你觉得**你最想优先用来“卡死错误 patch”的主指标**是哪一个？

A) gap（距离）
B) normal（方向）
C) area/connectivity（面积连通性）

你选一个（只选一个）。
选完我就把这一维的指标写得更“可操作”（比如阈值如何选、如何解释、为什么能区分平面延伸/曲面配不上）。
