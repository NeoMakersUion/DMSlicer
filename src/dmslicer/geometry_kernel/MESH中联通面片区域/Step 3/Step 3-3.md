
# **Step 3｜Patch Aggregation & Topological Expansion（定稿版·概念层）**

## 3.1 为什么必须有 Step 3（承接 Step 2 的必然性）

到 Step 2 为止，我们已经做到：

- 对**局部 patch**给出了可靠的区域支持度（SR、SR_agg）
    
- 解决了**碎片化覆盖**与**多对一覆盖**的判定不公问题
    
- 但仍然停留在：**“候选 patch 是局部的”**
    

现实问题是：

> **真实的公共接触面，往往跨越多个局部 patch，  
> 而这些 patch 在拓扑上相邻、几何上连续、语义上属于同一块区域。**

如果止步于 Step 2，就会产生：

- 一个公共面被切成多个 patch（过分割）
    
- 后续应用（统计面积、物理接触、制造分析）无法直接使用
    

👉 **Step 3 的目标**：  
**在保持 Step 2 几何可信度的前提下，将“属于同一公共区域”的 patch 进行拓扑聚合。**

---

## 3.2 Step 3 的输入 / 输出（先把接口说清楚）

### 输入（来自 Step 2）：

每个候选 patch $P_k$ 已具备：

- Support Ratio：$\mathrm{SR}_k$ 或 $\mathrm{SR}_{\text{agg},k}$
    
- 投影区域：$R_{A,k}, R_{B,k}$
    
- gap 统计：$\bar g_k, \mathrm{Var}(g_k)$
    
- 法线统计信息（局部）
    

### 输出（Step 3 的目标）：

- 一组 **聚合后的 patch 集合**：  
    $$ {\mathcal{G}_1, \mathcal{G}_2, \dots} $$  
    其中每个 $\mathcal{G}_i$ 表示一个**拓扑连通、几何一致的公共区域**。

---

## 3.3 Patch 聚合的核心思想（用一句话概括）

> **两个 patch 是否应被合并，  
> 取决于它们是否在拓扑上相邻，且在几何与支持度上“连续”。**

注意关键词：

- **不是**“只要挨着就合并”
    
- **不是**“SR 高就合并”
    
- 而是**多条件联合的“可合并性”**
    

---

## 3.4 拓扑邻接定义（你反复强调的“看周围相邻”）

这是 Step 3 的第一道门，也是最硬的一道门。

### 定义：Patch 的拓扑相邻（Topological Adjacency）

两个 patch $P_i, P_j$ 被认为**拓扑相邻**，当且仅当满足至少一条：

- 在 Object A 上：
    
    - $P_i^A$ 与 $P_j^A$ 的三角形集合共享边邻接（1-ring）
- 或在 Object B 上：
    
    - $P_i^B$ 与 $P_j^B$ 共享边邻接

> 直觉解释：  
> 如果它们在**至少一侧物体表面上是连成一片的**，  
> 那它们才有可能属于同一个公共区域。

⚠️ 非相邻 patch **永远不合并**（哪怕 SR 很高）。

---

## 3.5 几何连续性约束（防止“错误桥接”）

即使拓扑相邻，也**不一定**能合并。

### (A) 法线连续性（Local Orientation Continuity）

- 比较 $P_i$ 与 $P_j$ 的局部法线统计
    
- 要求：  
    $$ \angle(n_i, n_j) < \theta_{\text{merge}} $$
    

解释：

- 允许曲面缓慢变化
    
- 禁止跨越立方体锐边、折角、非共面突变
    

> 这一步确保：  
> 一个立方体的两个面**不会被合并**。

---

### (B) gap 连续性（Gap Continuity）

- 合并后 patch 的 gap 分布不能“突然变坏”：  
    $$ \bar g_{i \cup j} \le \max(\bar g_i, \bar g_j) + \delta_g $$

解释：

- 防止用 gap 很大的 patch 去“桥接”一个 gap 很小的主区域
    
- 对抗 BVH 误配导致的假邻接
    

---

## 3.6 支持度单调性（你最在意的“公平性”问题）

这是 Step 3 的**灵魂条件**，直接对应你说的：

> “单个不够 50%，但合起来是 100%”

### 支持度单调性约束（Support Monotonicity）

定义合并前后聚合支持度：  
$$ \mathrm{SR}_{\text{agg}}(P_i \cup P_j) $$

要求：  
$$ \mathrm{SR}_{\text{agg}}(P_i \cup P_j) \ge \min(\mathrm{SR}_{\text{agg}}(P_i),\ \mathrm{SR}_{\text{agg}}(P_j)) $$

直觉：

- 合并不应**降低**区域级可信度
    
- 若合并后支持度明显下降 → 说明桥接不合理
    

👉 这条规则**正是为了解决你担心的“不公平阈值问题”**。

---

## 3.7 聚合过程的性质（不是实现，是原则）

Step 3 的聚合过程满足以下原则：

- **局部性**：只在拓扑邻接的 patch 间发生
    
- **单调性**：支持度与一致性指标不恶化
    
- **可中断性**：无法合并即停止，不强求“全连通”
    
- **顺序无关性（理想目标）**：聚合结果不依赖遍历顺序（通过规则保证）
    

---

## 3.8 Step 3 的边界声明（非常重要）

> Step 3 的目标是**恢复公共区域的拓扑完整性**，  
> 而非强制输出最大连通区域。  
> 当几何一致性不足时，公共区域应自然分裂。

这句话会在评审时**救你**。

---

# ✅ 到这里，Step 3 的“概念定稿”已经完成

你现在已经有了一条**非常清晰的三段式逻辑链**：

1. **Step 1**：几何一致性基础（$\varepsilon$ / gap / soft normal）
    
2. **Step 2**：区域支持度判定（SR → SR_agg → 两阶段门控）
    
3. **Step 3**：拓扑扩展与公平聚合（邻接 + 连续性 + 单调性）